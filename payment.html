<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Payment - Virtech Group</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="icon" type="image/jpeg" href="profile.jpeg">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <section class="payment">
        <div class="container">
            <h2>Complete Your Payment</h2>
            <div class="payment-details">
                <p id="payment-info">Processing payment...</p>
                <button id="payButton" class="submit-button">Pay Now</button>
            </div>
        </div>
    </section>

    <script src="https://js.paystack.co/v1/inline.js"></script>
    <script>
        // Get URL parameters
        const urlParams = new URLSearchParams(window.location.search);
        const email = urlParams.get('email') || 'customer@example.com';
        const amount = parseInt(urlParams.get('amount')) || 2000;
        const name = urlParams.get('name') || 'Customer';
        const service = urlParams.get('service') || 'Service';

        // Update payment info
        document.getElementById('payment-info').textContent = `Service: ${service} - Amount: KES ${amount / 100} - Customer: ${name}`;

        // Payment functionality
        const payButton = document.getElementById('payButton');
        payButton.addEventListener('click', payWithPaystack);

        function payWithPaystack() {
          const ref = 'BOOKING_' + Date.now();

          const handler = PaystackPop.setup({
            key: 'pk_live_ae04fba4c6a70e8260b76ddc7d829f90d8be2b35',
            email: email,
            amount: amount,
            currency: 'KES',
            ref: ref,
            label: `${service} Booking Payment`,
            metadata: {
              customer_name: name,
              service: service
            },
            callback: function(response) {
              alert('Payment successful! You will receive a confirmation email with your booking details shortly.');

              // Send booking details to Zapier webhook
              fetch('https://hooks.zapier.com/hooks/catch/25228794/us6e7z5/', {
                method: 'POST',
                headers: {
                  'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                  email: email,
                  amount: amount,
                  name: name,
                  service: service,
                  reference: response.reference
                })
              }).then(() => {
                console.log('Booking details sent to Zapier');
              }).catch(err => {
                console.error('Failed to send to Zapier:', err);
              });

              window.location.href = 'index.html';
            },
            onClose: function() {
              alert('Payment was not completed. You can try again.');
              window.location.href = 'index.html';
            }
          });

          handler.openIframe();
        }
    </script>
</body>
</html>
